<!-- Accessible & Daltonism-friendly HTML -->
<div class="info-section" id="infoSection" aria-labelledby="infoHeading">
  <h2 id="infoHeading">Informations g√©n√©rales</h2>
  <p>
    Cette interface vous permet de simuler la propagation du virus √† J+3 selon les donn√©es que vous fournissez.
    Ajustez les curseurs pour refl√©ter votre situation r√©elle (cas, d√©c√®s, gu√©risons...).
    Le graphique ci-dessous affichera :
  </p>
  <ul>
    <li><strong>√Ä gauche</strong> : le nombre de cas actuellement saisis</li>
    <li><strong>√Ä droite</strong> : la pr√©diction de cas dans 3 jours r√©alis√©e par l‚ÄôIA</li>
  </ul>
  <p>
    <a href="#" (click)="openPopup($event)" aria-controls="popupIA" aria-expanded="false">Plus d'informations</a>
  </p>
</div>

<!-- Modal  -->
<div class="modal" *ngIf="showPopup" role="dialog" aria-modal="true" aria-labelledby="popupTitle" id="popupIA">
  <div class="modal-content">
    <button class="close-button" (click)="closePopup()" aria-label="Fermer la fen√™tre d'information">&times;</button>
    <h2 id="popupTitle">Comment fonctionne cette IA ?</h2>
    <p>
      Ce syst√®me de pr√©diction utilise un algorithme de <strong>r√©gression Random Forest</strong> entra√Æn√© sur des donn√©es historiques COVID.
    </p>
    <ul>
      <li>Il prend en compte 8 variables (nouveaux cas, d√©c√®s, gu√©risons, moyennes sur 3 jours, croissance...)</li>
      <li>Les donn√©es sont <strong>normalis√©es</strong> pour homog√©n√©iser les √©chelles</li>
      <li>La pr√©diction repr√©sente une <strong>estimation du nombre de cas √† J+3</strong></li>
      <li>Le mod√®le atteint un <strong>score R¬≤ sup√©rieur √† 0.91</strong>, garantissant une fiabilit√© √©lev√©e</li>
    </ul>
    <p>Le mod√®le a √©t√© √©valu√© sur un jeu de test et pr√©sente les performances suivantes :</p>
    <ul>
      <li><strong>R¬≤ :</strong> 0.917 (91.7% de la variance expliqu√©e)</li>
      <li><strong>MAE :</strong> 1594.14</li>
      <li><strong>RMSE :</strong> 1736.43</li>
    </ul>
  </div>
</div>

<form (ngSubmit)="onSubmit()" #f="ngForm">
  @for (key of objectKeys(form); track key) {
    <div class="slider-container">
      <label [attr.for]="key" class="slider-label">{{ formatKey(key) }}</label>

      <div class="range-slider">
        <input type="range"
               [id]="key"
               [attr.aria-label]="'Valeur de ' + formatKey(key)"
               [min]="key.includes('croissance') ? -1 : 0"
               [max]="key.includes('croissance') ? 1 : key.includes('ratio') ? 1 : 1000"
               [step]="key.includes('croissance') || key.includes('ratio') ? 0.01 : 1"
               [value]="form[key]"
               (input)="updateValue($event, key)"
               required />

        <output class="range-output" [attr.for]="key">{{ form[key] }}</output>
        <div class="range-track"></div>
      </div>

      <div class="range-labels">
        <span>{{ key.includes('croissance') ? -1 : 0 }}</span>
        <span>{{ key.includes('croissance') ? 1 : key.includes('ratio') ? 1 : 1000 }}</span>
      </div>
    </div>
  }
  <button type="submit">Pr√©dire la propagation</button>
</form>

@if (prediction !== null) {
  <div class="prediction-result" aria-live="polite" id="resultBlock">
    <h2>üìà Cas pr√©dits dans 3 jours</h2>
    <p>{{ prediction.toFixed(0) }} cas estim√©s</p>
  </div>
}

<div class="chart-container">
  <canvas id="chartCanvas" aria-label="Graphique de pr√©diction J+3" role="img"></canvas>
</div>
